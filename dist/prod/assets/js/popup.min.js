"use strict";const el_error=document.getElementById("error"),el_form=document.getElementById("form"),el_form_copy=document.getElementById("button"),el_form_input=document.getElementById("input"),el_loading=document.getElementById("loading"),el_qr_a=document.getElementById("qr-link"),el_qr_img=document.getElementById("qr-img"),App={init:function(){const qr=qrcode(0,"Q");qr.addData("https://shortly.is/"),qr.make(),document.getElementById("qr-code").innerHTML=qr.createImgTag(4),el_form_input.setAttribute("placeholder",App.langText("inputPlaceholder"))},inputCopyLink:function(){Func.copyToClipboard(el_form_input.value)},inputSelectLink:function(){el_form_input.focus(),el_form_input.select()},langText:function(name){return chrome.i18n.getMessage(Func.capitalizeFirstLetter(name))},shorten:function(page){let urlObject={},urlIsValid=!0;try{urlObject=new URL(page.url)}catch(e){console.error(e),urlIsValid=!1}urlIsValid&&["https:","http:"].includes(urlObject.protocol)&&!["shortly.is","shly.link"].includes(urlObject.domain)?FingerprintJS.load().then(fp=>{fp.get().then(result=>{const visitorId=result.visitorId,link=encodeURIComponent(page.url),request=new XMLHttpRequest;request.open("GET",`https://shortly.is/_/api/?app=aAMHu&fp=${visitorId}&url=${link}`,!0),request.onreadystatechange=function(){if(4===request.readyState){DOM.hide(el_error),DOM.hide(el_form),DOM.hide(el_loading);const result=JSON.parse(request.responseText);if(void 0===result.error){el_form_input.value=result.result_url;const qr=qrcode(0,"Q");qr.addData(result.result_url),qr.make(),document.getElementById("qr-code").innerHTML=qr.createImgTag(4),DOM.show(el_form),App.inputSelectLink()}else DOM.hide(el_loading),DOM.show(el_error),el_error.innerHTML=App.langText("extensionError")+": "+result.description}},request.send()})}):(DOM.hide(el_loading),DOM.show(el_error),el_error.innerHTML=App.langText("extensionError")+": "+App.langText("extensionErrorParseUrl"))}},DOM={hide:function(element){element.classList.contains("_shown")&&element.classList.remove("_shown"),element.classList.add("_hidden")},show:function(element){element.classList.contains("_hidden")&&element.classList.remove("_hidden"),element.classList.add("_shown")}},Func={capitalizeFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)},copyToClipboard:function(string){let el=document.createElement("input");el.style.position="fixed",el.style.opacity="0",el.value=string,document.body.appendChild(el),el.select(),document.execCommand("Copy"),document.body.removeChild(el)}};App.init(),chrome.tabs.getSelected(null,(function(currentPage){App.shorten(currentPage)})),el_form_copy.addEventListener("click",(function(){App.inputCopyLink()})),el_form_input.addEventListener("focus",(function(){App.inputSelectLink()}));